@using Microsoft.Extensions.Localization
@using Verdure.McpPlatform.Web.Resources
@inherits LayoutComponentBase
@inject IStringLocalizer<SharedResources> Loc

<MudThemeProvider Theme="_theme" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout Style="min-height: 100vh; display: flex; flex-direction: column;">
    <MudAppBar Elevation="1" Color="Color.Primary">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@ToggleDrawer" />
        <MudText Typo="Typo.h6" Class="ml-3">@Loc["AppTitle"]</MudText>
        <MudSpacer />
        <div class="d-flex align-center gap-2">
            <!-- 社区链接 -->
            <MudTooltip Text="GitHub 创客社区">
                <MudIconButton Icon="@Icons.Custom.Brands.GitHub" 
                              Color="Color.Inherit" 
                              Href="https://github.com/maker-community" 
                              Target="_blank" />
            </MudTooltip>
            <MudTooltip Text="项目源码">
                <MudIconButton Icon="@Icons.Material.Filled.Code" 
                              Color="Color.Inherit" 
                              Href="https://github.com/maker-community/verdure-mcp-for-xiaozhi" 
                              Target="_blank" />
            </MudTooltip>
            <MudTooltip Text="绿荫阿广 B站">
                <MudIconButton Icon="@Icons.Material.Filled.VideoLibrary" 
                              Color="Color.Inherit" 
                              Href="https://space.bilibili.com/25228512" 
                              Target="_blank" />
            </MudTooltip>
            <MudDivider Vertical="true" FlexItem="true" Style="height: 30px; margin: 0 8px;" />
            <CultureSelector TextColor="#FFFFFF" />
            <AuthorizeView>
                <Authorized>
                    <MudMenu Icon="@Icons.Material.Filled.AccountCircle" Color="Color.Inherit" AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight">
                        <MudMenuItem>
                            <div class="d-flex flex-column pa-2">
                                <MudText Typo="Typo.body2" Style="font-weight: 600;">@context.User.Identity?.Name</MudText>
                                <MudText Typo="Typo.caption" Color="Color.Secondary">@context.User.FindFirst("email")?.Value</MudText>
                            </div>
                        </MudMenuItem>
                        <MudDivider />
                        <MudMenuItem Href="/settings" Icon="@Icons.Material.Filled.Settings">@Loc["Settings"]</MudMenuItem>
                        <MudMenuItem Href="/logout" Icon="@Icons.Material.Filled.Logout">@Loc["Logout"]</MudMenuItem>
                    </MudMenu>
                </Authorized>
                <NotAuthorized>
                    <MudButton Href="/login" Variant="Variant.Text" Color="Color.Inherit" StartIcon="@Icons.Material.Filled.Login">
                        @Loc["Login"]
                    </MudButton>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </MudAppBar>
    
    <MudDrawer @bind-Open="_drawerOpen" Elevation="1" ClipMode="DrawerClipMode.Always">
        <NavMenu />
    </MudDrawer>
    
    <MudMainContent Style="display: flex; flex-direction: column; flex: 1; min-height: 0;">
        <!-- 主内容区域 - flex-grow: 1 确保占据剩余空间 -->
        <div style="flex: 1; padding: 1rem;">
            <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="my-6">
                @Body
            </MudContainer>
        </div>
        
        <!-- Footer 始终在底部 -->
        <Footer IsCompact="true" />
    </MudMainContent>
</MudLayout>

@code {
    private bool _drawerOpen = true;
    
    private MudTheme _theme = new()
    {
        PaletteLight = new PaletteLight()
        {
            // M3 Primary - 使用更现代的蓝色调
            Primary = "#1976D2",              // Material Blue 700
            PrimaryContrastText = "#FFFFFF",
            PrimaryDarken = "#1565C0",        // Blue 800
            PrimaryLighten = "#BBDEFB",       // Blue 100
            
            // M3 Secondary - 青色系
            Secondary = "#0097A7",            // Cyan 700
            SecondaryContrastText = "#FFFFFF",
            SecondaryDarken = "#00838F",      // Cyan 800
            SecondaryLighten = "#B2EBF2",     // Cyan 100
            
            // M3 Tertiary - 现代中性灰（移除紫罗兰）
            Tertiary = "#5F6368",             // Google Grey 700
            TertiaryContrastText = "#FFFFFF",
            TertiaryDarken = "#3C4043",       // Google Grey 900
            TertiaryLighten = "#E8EAED",      // Google Grey 100
            
            // M3 Surface - 纯净浅灰背景
            Surface = "#FFFFFF",
            Background = "#FAFAFA",           // 更中性的浅灰背景
            AppbarBackground = "#1976D2",     // 与 Primary 一致
            DrawerBackground = "#FFFFFF",
            DrawerText = "#424242",
            
            // 语义色彩
            Success = "#2E7D32",              // Green 800
            Info = "#0288D1",                 // Light Blue 700
            Warning = "#F57C00",              // Orange 800
            Error = "#D32F2F",                // Red 700
            
            // 文本颜色
            TextPrimary = "#212121",          // Grey 900
            TextSecondary = "#757575",        // Grey 600
            TextDisabled = "#BDBDBD",         // Grey 400
            
            // 边框和分隔线
            Divider = "#E0E0E0",              // Grey 300
            DividerLight = "#F5F5F5",         // Grey 100
            
            // Actions
            ActionDefault = "#757575",
            ActionDisabled = "rgba(0, 0, 0, 0.26)",
            ActionDisabledBackground = "rgba(0, 0, 0, 0.12)",
            
            // Hover
            HoverOpacity = 0.04,
        },
        
        PaletteDark = new PaletteDark()
        {
            Primary = "#90CAF9",              // Blue 200
            PrimaryContrastText = "#0D47A1",  // Blue 900
            PrimaryDarken = "#64B5F6",        // Blue 300
            PrimaryLighten = "#1976D2",       // Blue 700
            
            Secondary = "#80DEEA",            // Cyan 200
            SecondaryContrastText = "#006064", // Cyan 900
            SecondaryDarken = "#4DD0E1",      // Cyan 300
            SecondaryLighten = "#0097A7",     // Cyan 700
            
            Tertiary = "#9AA0A6",             // Google Grey 500
            TertiaryContrastText = "#FFFFFF", // 改为白色以提高对比度
            TertiaryDarken = "#5F6368",       // Google Grey 700
            TertiaryLighten = "#E8EAED",      // Google Grey 100
            
            Surface = "#1E1E1E",
            Background = "#121212",
            AppbarBackground = "#1E1E1E",
            DrawerBackground = "#1E1E1E",
            DrawerText = "#FFFFFF",
            
            Success = "#66BB6A",              // Green 400
            Info = "#42A5F5",                 // Blue 400
            Warning = "#FFA726",              // Orange 400
            Error = "#EF5350",                // Red 400
            
            TextPrimary = "#FFFFFF",
            TextSecondary = "#B0B0B0",
            TextDisabled = "#6C6C6C",
            
            Divider = "#3C3C3C",
            DividerLight = "#2C2C2C",
            
            ActionDefault = "#FFFFFF",
            ActionDisabled = "rgba(255, 255, 255, 0.3)",
            ActionDisabledBackground = "rgba(255, 255, 255, 0.12)",
            
            HoverOpacity = 0.08,
        },
        
        // 从 MudBlazor 官方源码复制的正确 Shadows 配置
        // https://github.com/MudBlazor/MudBlazor/blob/main/src/MudBlazor/Themes/Models/Shadow.cs
        Shadows = new Shadow()
        {
            Elevation = new string[]
            {
                "none",
                "0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12)",
                "0px 3px 1px -2px rgba(0,0,0,0.2),0px 2px 2px 0px rgba(0,0,0,0.14),0px 1px 5px 0px rgba(0,0,0,0.12)",
                "0px 3px 3px -2px rgba(0,0,0,0.2),0px 3px 4px 0px rgba(0,0,0,0.14),0px 1px 8px 0px rgba(0,0,0,0.12)",
                "0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12)",
                "0px 3px 5px -1px rgba(0,0,0,0.2),0px 5px 8px 0px rgba(0,0,0,0.14),0px 1px 14px 0px rgba(0,0,0,0.12)",
                "0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12)",
                "0px 4px 5px -2px rgba(0,0,0,0.2),0px 7px 10px 1px rgba(0,0,0,0.14),0px 2px 16px 1px rgba(0,0,0,0.12)",
                "0px 5px 5px -3px rgba(0,0,0,0.2),0px 8px 10px 1px rgba(0,0,0,0.14),0px 3px 14px 2px rgba(0,0,0,0.12)",
                "0px 5px 6px -3px rgba(0,0,0,0.2),0px 9px 12px 1px rgba(0,0,0,0.14),0px 3px 16px 2px rgba(0,0,0,0.12)",
                "0px 6px 6px -3px rgba(0,0,0,0.2),0px 10px 14px 1px rgba(0,0,0,0.14),0px 4px 18px 3px rgba(0,0,0,0.12)",
                "0px 6px 7px -4px rgba(0,0,0,0.2),0px 11px 15px 1px rgba(0,0,0,0.14),0px 4px 20px 3px rgba(0,0,0,0.12)",
                "0px 7px 8px -4px rgba(0,0,0,0.2),0px 12px 17px 2px rgba(0,0,0,0.14),0px 5px 22px 4px rgba(0,0,0,0.12)",
                "0px 7px 8px -4px rgba(0,0,0,0.2),0px 13px 19px 2px rgba(0,0,0,0.14),0px 5px 24px 4px rgba(0,0,0,0.12)",
                "0px 7px 9px -4px rgba(0,0,0,0.2),0px 14px 21px 2px rgba(0,0,0,0.14),0px 5px 26px 4px rgba(0,0,0,0.12)",
                "0px 8px 9px -5px rgba(0,0,0,0.2),0px 15px 22px 2px rgba(0,0,0,0.14),0px 6px 28px 5px rgba(0,0,0,0.12)",
                "0px 8px 10px -5px rgba(0,0,0,0.2),0px 16px 24px 2px rgba(0,0,0,0.14),0px 6px 30px 5px rgba(0,0,0,0.12)",
                "0px 8px 11px -5px rgba(0,0,0,0.2),0px 17px 26px 2px rgba(0,0,0,0.14),0px 6px 32px 5px rgba(0,0,0,0.12)",
                "0px 9px 11px -5px rgba(0,0,0,0.2),0px 18px 28px 2px rgba(0,0,0,0.14),0px 7px 34px 6px rgba(0,0,0,0.12)",
                "0px 9px 12px -6px rgba(0,0,0,0.2),0px 19px 29px 2px rgba(0,0,0,0.14),0px 7px 36px 6px rgba(0,0,0,0.12)",
                "0px 10px 13px -6px rgba(0,0,0,0.2),0px 20px 31px 3px rgba(0,0,0,0.14),0px 8px 38px 7px rgba(0,0,0,0.12)",
                "0px 10px 13px -6px rgba(0,0,0,0.2),0px 21px 33px 3px rgba(0,0,0,0.14),0px 8px 40px 7px rgba(0,0,0,0.12)",
                "0px 10px 14px -6px rgba(0,0,0,0.2),0px 22px 35px 3px rgba(0,0,0,0.14),0px 8px 42px 7px rgba(0,0,0,0.12)",
                "0px 11px 14px -7px rgba(0,0,0,0.2),0px 23px 36px 3px rgba(0,0,0,0.14),0px 9px 44px 8px rgba(0,0,0,0.12)",
                "0px 11px 15px -7px rgba(0,0,0,0.2),0px 24px 38px 3px rgba(0,0,0,0.14),0px 9px 46px 8px rgba(0,0,0,0.12)",
                "0 5px 5px -3px rgba(0,0,0,.06), 0 8px 10px 1px rgba(0,0,0,.042), 0 3px 14px 2px rgba(0,0,0,.036)"
            }
        },
        
        LayoutProperties = new LayoutProperties()
        {
            DefaultBorderRadius = "8px",
            AppbarHeight = "64px",
            DrawerWidthLeft = "260px",
            DrawerWidthRight = "260px",
        }
    };

    private void ToggleDrawer()
    {
        _drawerOpen = !_drawerOpen;
    }
}
