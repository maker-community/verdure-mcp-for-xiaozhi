@using Microsoft.Extensions.Localization
@using Verdure.McpPlatform.Web.Resources
@using Verdure.McpPlatform.Web.Icons
@inherits LayoutComponentBase
@inject IStringLocalizer<SharedResources> Loc

<MudThemeProvider Theme="_theme" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <!-- 全宽顶部导航栏 - 透明背景，固定在顶部 -->
    <MudAppBar Elevation="0" Style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(0,0,0,0.08);">
        <MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="d-flex align-center justify-space-between px-4" Style="width: 100%;">
            <!-- Logo 和标题：窄屏时移除 gap 以节省空间 -->
            <div class="d-flex align-center" style="gap: 0;">
                <img src="app-logo.png" 
                     alt="Verdure Logo" 
                     style="width: 40px; height: 40px;" />
                <!-- 平台标题：在手机等窄屏幕设备上隐藏，以节省空间 -->
                <MudText Typo="Typo.h6" Class="d-none d-sm-block" Style="color: #1976D2; font-weight: 600; margin-left: 0.75rem;">
                    Verdure MCP Platform
                </MudText>
            </div>
            
            <!-- 右侧导航和操作 -->
            <div class="d-flex align-center gap-4">
                <!-- 导航链接：在平板以下设备隐藏 -->
                <MudLink Href="/#features" Underline="Underline.None" Class="d-none d-md-block" Style="color: #424242; font-weight: 500;">
                    @Loc["Features"]
                </MudLink>
                <MudLink Href="/#architecture" Underline="Underline.None" Class="d-none d-md-block" Style="color: #424242; font-weight: 500;">
                    @Loc["Architecture"]
                </MudLink>
                <MudLink Href="/#community" Underline="Underline.None" Class="d-none d-md-block" Style="color: #424242; font-weight: 500;">
                    @Loc["Community"]
                </MudLink>
                
                <!-- 分隔线：在平板以下设备隐藏 -->
                <MudDivider Vertical="true" FlexItem="true" Class="d-none d-md-block" Style="height: 30px;" />
                
                <!-- 社区图标链接：在手机等窄屏幕设备上隐藏部分图标 -->
                <MudTooltip Text="@Loc["TooltipGitHubCommunity"]">
                    <MudIconButton Icon="@Icons.Material.Filled.Groups" 
                                  Size="Size.Medium"
                                  Class="d-none d-sm-inline-flex"
                                  Style="color: #424242;"
                                  Href="https://github.com/maker-community" 
                                  Target="_blank" />
                </MudTooltip>
                <MudTooltip Text="@Loc["TooltipProjectSource"]">
                    <MudIconButton Icon="@Icons.Custom.Brands.GitHub" 
                                  Size="Size.Medium"
                                  Style="color: #424242;"
                                  Href="https://github.com/maker-community/verdure-mcp-for-xiaozhi" 
                                  Target="_blank" />
                </MudTooltip>
                <MudTooltip Text="@Loc["TooltipBilibiliChannel"]">
                    <MudIconButton Icon="@VerdureIcons.SocialMedia.Bilibili" 
                                  Size="Size.Medium"
                                  Class="d-none d-sm-inline-flex"
                                  Style="color: #424242;"
                                  Href="https://space.bilibili.com/25228512" 
                                  Target="_blank" />
                </MudTooltip>
                
                <!-- 分隔线：在手机等窄屏幕设备上隐藏 -->
                <MudDivider Vertical="true" FlexItem="true" Class="d-none d-sm-block" Style="height: 30px;" />
                
                <!-- 语言切换 -->
                <CultureSelector TextColor="#424242" />
                
                <!-- 登录/用户菜单 -->
                <AuthorizeView>
                    <Authorized>
                        <!-- 控制台按钮：窄屏仅图标，宽屏带文字 -->
                        <MudIconButton Icon="@Icons.Material.Filled.Dashboard"
                                      Size="Size.Medium"
                                      Color="Color.Primary"
                                      Href="/dashboard"
                                      Class="d-inline-flex d-sm-none mr-2" />
                        <MudButton Href="/dashboard" 
                                  Variant="Variant.Filled" 
                                  Color="Color.Primary"
                                  StartIcon="@Icons.Material.Filled.Dashboard"
                                  Size="Size.Small"
                                  Class="d-none d-sm-inline-flex mr-2">
                            @Loc["Console"]
                        </MudButton>
                        
                        <!-- 用户菜单 -->
                        <MudMenu Icon="@Icons.Material.Filled.AccountCircle" 
                                 AnchorOrigin="Origin.BottomRight" 
                                 TransformOrigin="Origin.TopRight"
                                 Style="color: #424242;">
                            <ActivatorContent>
                                <MudIconButton Icon="@Icons.Material.Filled.AccountCircle" 
                                              Size="Size.Medium"
                                              Style="color: #424242;" />
                            </ActivatorContent>
                            <ChildContent>
                                <MudMenuItem>
                                    <div class="d-flex flex-column pa-2">
                                        <MudText Typo="Typo.body2" Style="font-weight: 600;">@context.User.Identity?.Name</MudText>
                                        <MudText Typo="Typo.caption" Color="Color.Secondary">@context.User.FindFirst("email")?.Value</MudText>
                                    </div>
                                </MudMenuItem>
                                <MudDivider />
                                <MudMenuItem Href="/settings" Icon="@Icons.Material.Filled.Settings">@Loc["Settings"]</MudMenuItem>
                                <MudMenuItem Href="/logout" Icon="@Icons.Material.Filled.Logout">@Loc["Logout"]</MudMenuItem>
                            </ChildContent>
                        </MudMenu>
                    </Authorized>
                    <NotAuthorized>
                        <!-- 登录按钮：窄屏仅图标，宽屏带文字 -->
                        <MudIconButton Icon="@Icons.Material.Filled.Login"
                                      Size="Size.Medium"
                                      Color="Color.Primary"
                                      Href="authentication/login"
                                      Class="d-inline-flex d-sm-none" />
                        <MudButton Href="authentication/login" 
                                  Variant="Variant.Filled" 
                                  Color="Color.Primary" 
                                  StartIcon="@Icons.Material.Filled.Login"
                                  Size="Size.Small"
                                  Class="d-none d-sm-inline-flex">
                            @Loc["Login"]
                        </MudButton>
                    </NotAuthorized>
                </AuthorizeView>
            </div>
        </MudContainer>
    </MudAppBar>
    
    <!-- 主内容区域 - 全宽，无侧边栏 -->
    <MudMainContent Style="padding: 0; background: #FAFAFA;">
        @Body
        <Footer />
    </MudMainContent>
</MudLayout>

@code {
    private MudTheme _theme = new()
    {
        PaletteLight = new PaletteLight()
        {
            Primary = "#1976D2",
            PrimaryContrastText = "#FFFFFF",
            PrimaryDarken = "#1565C0",
            PrimaryLighten = "#BBDEFB",
            
            Secondary = "#0097A7",
            SecondaryContrastText = "#FFFFFF",
            SecondaryDarken = "#00838F",
            SecondaryLighten = "#B2EBF2",
            
            Tertiary = "#5F6368",
            TertiaryContrastText = "#FFFFFF",
            TertiaryDarken = "#3C4043",
            TertiaryLighten = "#E8EAED",
            
            Surface = "#FFFFFF",
            Background = "#FAFAFA",
            AppbarBackground = "#FFFFFF",
            DrawerBackground = "#FFFFFF",
            DrawerText = "#424242",
            
            Success = "#2E7D32",
            Info = "#0288D1",
            Warning = "#F57C00",
            Error = "#D32F2F",
            
            TextPrimary = "#212121",
            TextSecondary = "#757575",
            TextDisabled = "#BDBDBD",
            
            Divider = "#E0E0E0",
            DividerLight = "#F5F5F5",
            
            ActionDefault = "#757575",
            ActionDisabled = "rgba(0, 0, 0, 0.26)",
            ActionDisabledBackground = "rgba(0, 0, 0, 0.12)",
            
            HoverOpacity = 0.04,
        },
        
        LayoutProperties = new LayoutProperties()
        {
            DefaultBorderRadius = "12px",
            AppbarHeight = "72px",
        }
    };
}
