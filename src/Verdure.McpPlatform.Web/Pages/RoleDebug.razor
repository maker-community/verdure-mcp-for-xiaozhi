@page "/debug/roles"
@layout MainLayout
@attribute [Authorize]
@using Microsoft.Extensions.Localization
@using Verdure.McpPlatform.Web.Resources
@using Verdure.McpPlatform.Web.Components
@using MudBlazor
@inject IStringLocalizer<SharedResources> Loc

<PageTitle>@Loc["RoleDebug"] - @Loc["AppTitle"]</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <!-- Header -->
    <MudPaper Class="pa-4 mb-4" Elevation="2">
        <MudText Typo="Typo.h4" Class="mb-2">
            <MudIcon Icon="@Icons.Material.Filled.BugReport" Class="mr-2" />
            角色调试面板
        </MudText>
        <MudText Typo="Typo.body1" Color="Color.Secondary">
            此页面用于开发和调试用户角色映射功能
        </MudText>
    </MudPaper>

    <!-- Debug Panel -->
    <UserRoleDebugPanel />

    <!-- Additional Info -->
    <MudPaper Class="pa-4 mt-4" Elevation="1">
        <MudText Typo="Typo.h6" Class="mb-3">
            <MudIcon Icon="@Icons.Material.Filled.Info" Class="mr-2" />
            角色映射说明
        </MudText>
        
        <MudAlert Severity="Severity.Info" Dense="true" Class="mb-2">
            <MudText Typo="Typo.body2">
                <strong>后端映射：</strong>在 JWT Bearer 认证的 OnTokenValidated 事件中自动映射
            </MudText>
        </MudAlert>
        
        <MudAlert Severity="Severity.Info" Dense="true" Class="mb-2">
            <MudText Typo="Typo.body2">
                <strong>前端映射：</strong>通过 KeycloakRoleClaimsPrincipalFactory 在用户认证后自动映射
            </MudText>
        </MudAlert>
        
        <MudAlert Severity="Severity.Success" Dense="true">
            <MudText Typo="Typo.body2">
                <strong>角色来源：</strong>从 JWT Token 的 resource_access.{'{'}ClientId{'}'}.roles 中提取
            </MudText>
        </MudAlert>
    </MudPaper>

    <!-- Documentation Links -->
    <MudPaper Class="pa-4 mt-4" Elevation="1">
        <MudText Typo="Typo.h6" Class="mb-3">
            <MudIcon Icon="@Icons.Material.Filled.MenuBook" Class="mr-2" />
            相关文档
        </MudText>
        
        <MudList T="string" Dense="true">
            <MudListItem T="string" Icon="@Icons.Material.Filled.Article">
                <MudText Typo="Typo.body2">
                    <strong>Blazor 角色映射指南：</strong> docs/guides/BLAZOR_ROLE_MAPPING.md
                </MudText>
            </MudListItem>
            <MudListItem T="string" Icon="@Icons.Material.Filled.Article">
                <MudText Typo="Typo.body2">
                    <strong>后端角色映射实现：</strong> docs/KEYCLOAK_ROLE_MAPPING_IMPLEMENTATION.md
                </MudText>
            </MudListItem>
            <MudListItem T="string" Icon="@Icons.Material.Filled.Article">
                <MudText Typo="Typo.body2">
                    <strong>快速参考：</strong> docs/guides/BLAZOR_ROLE_MAPPING_QUICK_REF.md
                </MudText>
            </MudListItem>
            <MudListItem T="string" Icon="@Icons.Material.Filled.Article">
                <MudText Typo="Typo.body2">
                    <strong>完整方案总结：</strong> docs/KEYCLOAK_ROLE_MAPPING_COMPLETE.md
                </MudText>
            </MudListItem>
        </MudList>
    </MudPaper>

    <!-- Back Button -->
    <MudPaper Class="pa-4 mt-4 d-flex justify-center" Elevation="0">
        <MudButton Href="/"
                   Variant="Variant.Outlined"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.Home"
                   Size="Size.Large">
            返回首页
        </MudButton>
    </MudPaper>
</MudContainer>
