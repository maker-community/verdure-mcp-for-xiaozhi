@using Verdure.McpPlatform.Contracts.Models
@using Microsoft.Extensions.Localization
@using Verdure.McpPlatform.Web.Resources
@inject IStringLocalizer<SharedResources> Loc

<MudGrid>
    <MudItem xs="12" md="6">
        <MudTextField @bind-Value="Config.HeaderName"
                     Label="@Loc["ApiKeyHeaderName"]"
                     Variant="Variant.Outlined"
                     Required="true"
                     Placeholder="X-API-Key"
                     HelperText="@Loc["ApiKeyHeaderNameHelp"]" />
    </MudItem>

    <MudItem xs="12" md="6">
        <MudTextField @bind-Value="Config.Prefix"
                     Label="@Loc["ApiKeyPrefix"]"
                     Variant="Variant.Outlined"
                     Placeholder="ApiKey "
                     HelperText="@Loc["ApiKeyPrefixHelp"]" />
    </MudItem>

    <MudItem xs="12">
        <MudTextField @bind-Value="Config.ApiKey"
                     Label="@Loc["ApiKey"]"
                     Variant="Variant.Outlined"
                     Required="true"
                     InputType="@_passwordInput"
                     Adornment="Adornment.End"
                     AdornmentIcon="@_passwordInputIcon"
                     OnAdornmentClick="TogglePasswordVisibility"
                     HelperText="@Loc["ApiKeyHelp"]" />
    </MudItem>

    <MudItem xs="12">
        <MudAlert Severity="Severity.Info" Dense="true">
            @Loc["ApiKeyExample"]: <code>@(Config.HeaderName ?? "X-API-Key"): @(Config.Prefix)your-api-key</code>
        </MudAlert>
    </MudItem>
</MudGrid>

@code {
    [Parameter]
    public ApiKeyAuthConfig Config { get; set; } = new();

    [Parameter]
    public EventCallback<ApiKeyAuthConfig> ConfigChanged { get; set; }

    private bool _isPasswordVisible;
    private InputType _passwordInput = InputType.Password;
    private string _passwordInputIcon = Icons.Material.Filled.VisibilityOff;

    void TogglePasswordVisibility()
    {
        if (_isPasswordVisible)
        {
            _isPasswordVisible = false;
            _passwordInputIcon = Icons.Material.Filled.VisibilityOff;
            _passwordInput = InputType.Password;
        }
        else
        {
            _isPasswordVisible = true;
            _passwordInputIcon = Icons.Material.Filled.Visibility;
            _passwordInput = InputType.Text;
        }
    }

    private async Task OnConfigChanged()
    {
        await ConfigChanged.InvokeAsync(Config);
    }
}
